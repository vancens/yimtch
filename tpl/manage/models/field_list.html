<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <title>字段列表</title>
    {include file="public/source_head"}
</head>
<body>
<div class="layui-fluid">

    <blockquote class="layui-elem-quote va-head-positon">
                <span class="layui-breadcrumb">
                    <a><i class="layui-icon layui-icon-home"></i> 当前位置</a>
                    <a href="{:url('modelList')}">模型列表</a>
                    <a><cite>{$data_model.name}</cite></a>
                    <a><cite>字段列表</cite></a>
                </span>
        <div class="layui-btn-group">

            <a class="layui-btn layui-btn-xs layui-btn-normal" onclick="i_reload()">
                <i class="layui-icon layui-icon-refresh"></i> 刷新
            </a>
            <a class="layui-btn layui-btn-xs layui-btn-warm" onclick="i_back()">
                <i class="layui-icon layui-icon-return"></i> 返回
            </a>
            <a class="layui-btn layui-btn-xs layui-btn-danger" href="{:url('fieldAdd',['mid'=>$data_model.id])}">
                <i class="layui-icon layui-icon-add-1"></i> 增加字段
            </a>
        </div>
    </blockquote>

    <form class="layui-form">
        <table class="layui-table layui-hide" lay-filter="static">
            <thead>
            <tr>

                <th lay-data="{field:'id', width:50}">ID</th>
                <th lay-data="{field:'name'}">名称</th>
                <th lay-data="{field:'fieldname'}">字段名</th>
                <th lay-data="{field:'type'}">字段类别</th>
                <th lay-data="{field:'length'}">字段长度</th>
                <th lay-data="{field:'value'}">字段值</th>
                <th lay-data="{field:'order'}">排序</th>
                <th lay-data="{field:'edit', width:150}"></th>
            </tr>
            </thead>
            <tbody>
            {volist name="data_field" id="vo"}
            <tr>
                <td>{$vo.id}</td>
                <td>{$vo.name}</td>
                <td>{$vo.db_field_name}</td>
                <td>{$vo.with_form.name}({$vo.with_form.db_type_name})</td>
                <td>{$vo.db_field_length|default='/'}</td>
                <td>{$vo.db_field_values|default='/'}</td>
                <td>{$vo.order}</td>
                <td>
                    <div class="layui-btn-group">
                        <a class="layui-btn layui-btn-sm layui-btn-primary" href="{:url('fieldEdit',['cid'=>$vo.id])}" title="修改">
                            <i class="layui-icon">&#xe642;</i>
                        </a>
                        <a class="layui-btn layui-btn-sm layui-btn-primary" onclick="deleteId('{$vo.id}')" title="删除">
                            <i class="layui-icon">&#xe640;</i>
                        </a>
                    </div>
                </td>
            </tr>
            {/volist}
            </tbody>
        </table>
    </form>
</div>
<!--js-->
{include file="public/source_bottom" /}
<script>
    $(function (){
        //转换静态表格
        table.init('static', {
            limit: 10,
            page:true,
            size:'lg'

        });
    })
    //删除
    function deleteId(id){
        layer.confirm('确认删除?', {icon: 3, title:'提示'}, function(index){
            $.ajax({
                url :"{:url('fieldDelete')}",
                type: "POST"
                ,data: {
                    id: id
                }
                ,success: function(msg){
                    layer.closeAll('loading'); //关闭加载层
                    if(msg.code == 1){
                        layer.alert(msg.msg, {icon: 1},function(index){
                            layer.close(index);
                            window.location.reload();
                        });
                    }else{
                        layer.alert(msg.msg, {icon: 2},function(index){
                            layer.close(index);
                        });
                    }
                },error: function(){
                    layer.closeAll('loading');
                    layer.msg('数据提交错误');
                },beforeSend: function(){
                    layer.load();
                }
            });
            layer.close(index);
        });
    }
</script>
</body>
</html>