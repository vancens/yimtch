<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <title>修改栏目</title>
    {include file="public/source_head"}
</head>
<body>
    <div class="layui-fluid">

        <blockquote class="layui-elem-quote va-head-positon">
            <span class="layui-breadcrumb">
                <a><i class="layui-icon layui-icon-home"></i> 当前位置</a>
                <a href="{:url('columnList')}">栏目列表</a>
                <a><cite>修改栏目</cite></a>
            </span>
            <div class="layui-btn-group">
                <a class="layui-btn layui-btn-xs layui-btn-normal" onclick="i_reload()">
                    <i class="layui-icon layui-icon-refresh"></i> 刷新
                </a>
                <a class="layui-btn layui-btn-xs layui-btn-warm" onclick="i_back()">
                    <i class="layui-icon layui-icon-return"></i> 返回
                </a>
            </div>
        </blockquote>

        <form class="layui-form layui-form-pane">
            <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
                <ul class="layui-tab-title">
                    <li class="layui-this">栏目信息</li>
                    <li class="">栏目模型</li>
                    <li class="">SEO设置</li>
                    <li class="">内容</li>
                </ul>
                <div class="layui-tab-content">
                    <!--栏目信息-->
                    <div class="layui-tab-item layui-show">
                        <table class="layui-table">
                            <colgroup>
                                <col width="10%">
                                <col width="70%">
                                <col>
                            </colgroup>
                            <thead>
                            <tr>
                                <th>名称</th>
                                <th>值</th>
                                <th></th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>上级栏目</td>
                                <td>
                                    <select name="pid" lay-verify="required" required>
                                        <option value="0">顶级栏目</option>
                                        {volist name=":model('CmsColumnList')->retTree()" id="vo"}
                                        {if $vo.id == $data.pid}
                                        <option value="{$vo.id}" selected>{:str_repeat('-',($vo.level)*4)}{$vo.name}</option>
                                        {else}
                                        <option value="{$vo.id}">{:str_repeat('-',($vo.level)*4)}{$vo.name}</option>
                                        {/if}
                                        {/volist}
                                    </select>
                                </td>
                                <td>*</td>
                            </tr>
                            <tr>
                                <td>名称</td>
                                <td>
                                    <input type="text" name="name" value="{$data.name}" required  lay-verify="required" class="layui-input">
                                </td>
                                <td>*</td>
                            </tr>
                            <tr>
                                <td>英文名称</td>
                                <td>
                                    <input type="text" name="name_en" value="{$data.name_en}" class="layui-input">
                                </td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>栏目描述</td>
                                <td>
                                    <textarea name="info" class="layui-textarea">{$data.info}</textarea>
                                </td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>图片</td>
                                <td>
                                    <!--源图-->
                                    <input type="text" name="litpic" class="v-pic layui-input upload-input" value="{$data.litpic}">
                                    <a class="layui-btn layui-btn-sm upimg"><i class="layui-icon layui-icon-upload"></i> 上传</a>
                                    {if $data.litpic}
                                    <a class="layui-btn layui-btn-sm yulan" href="{$data.litpic}" target="_blank">
                                        <i class="layui-icon layui-icon-about"></i> 预览
                                    </a>
                                    {else}
                                    <a class="layui-btn layui-btn-sm yulan layui-hide" href="" target="_blank">
                                        <i class="layui-icon layui-icon-about"></i> 预览
                                    </a>
                                    {/if}
                                </td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>隐藏栏目</td>
                                <td>
                                    {if $data.is_hide == 0}
                                    <input type="radio" name="is_hide" value="1" title="是">
                                    <input type="radio" name="is_hide" value="0" title="否" checked>
                                    {else}
                                    <input type="radio" name="is_hide" value="1" title="是" checked>
                                    <input type="radio" name="is_hide" value="0" title="否">
                                    {/if}
                                </td>
                                <td>*</td>
                            </tr>
                            <tr>
                                <td>栏目url标识</td>
                                <td>
                                    <input type="text" name="sign" required  lay-verify="required" value="{$data.sign}" class="layui-input">
                                </td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>排序</td>
                                <td>
                                    <input type="text" name="order" value="{$data.order}"  class="layui-input">
                                </td>
                                <td>*</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <!--栏目模型-->
                    <div class="layui-tab-item">
                        <table class="layui-table">
                            <colgroup>
                                <col width="10%">
                                <col width="70%">
                                <col>
                            </colgroup>
                            <thead>
                            <tr>
                                <th>名称</th>
                                <th>值</th>
                                <th></th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>所属模型</td>
                                <td>
                                    <select name="model_id" lay-verify="required" required>
                                        <option value="">请选择</option>
                                        {volist name=":model('CmsModelList')->select()" id="vo"}
                                        {if $vo.id == $data.model_id}
                                        <option value="{$vo.id}" selected>{$vo.name}</option>
                                        {else}
                                        <option value="{$vo.id}">{$vo.name}</option>
                                        {/if}
                                        {/volist}
                                    </select>
                                </td>
                                <td>*</td>
                            </tr>
                            <tr>
                                <td>栏目类别</td>
                                <td>
                                    {volist name=":model('CmsColumnType')->all()" id="vo"}
                                    {if $data.type == $vo.id}
                                    <input type="radio" name="type" value="{$vo.id}" title="{$vo.name}" checked>
                                    {else}
                                    <input type="radio" name="type" value="{$vo.id}" title="{$vo.name}">
                                    {/if}
                                    {/volist}
                                </td>
                                <td>*</td>
                            </tr>
                            <tr>
                                <td>外链URL</td>
                                <td>
                                    <input type="text" name="link_url" value="{$data.link_url}" class="layui-input">
                                </td>
                                <td>当栏目类别为（外链）时填写</td>
                            </tr>
                            <tr>
                                <td>列表页模板</td>
                                <td>
                                    <select name="list_html" lay-search>
                                        <option value="">请选择</option>
                                        {foreach $template as $value}
                                        {if $data.list_html == ret_template_name($value)}
                                        <option value="{$value|ret_template_name}" selected>{$value}</option>
                                        {else}
                                        <option value="{$value|ret_template_name}">{$value}</option>
                                        {/if}
                                        {/foreach}
                                    </select>
                                </td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>内容页模板</td>
                                <td>
                                    <select name="content_html" lay-search>
                                        <option value="">请选择</option>
                                        {foreach $template as $value}
                                        {if $data.content_html == ret_template_name($value)}
                                        <option value="{$value|ret_template_name}" selected>{$value}</option>
                                        {else}
                                        <option value="{$value|ret_template_name}">{$value}</option>
                                        {/if}
                                        {/foreach}
                                    </select>
                                </td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>单页模板</td>
                                <td>
                                    <select name="single_html" lay-search>
                                        <option value="">请选择</option>
                                        {foreach $template as $value}
                                        {if $data.single_html == ret_template_name($value)}
                                        <option value="{$value|ret_template_name}" selected>{$value}</option>
                                        {else}
                                        <option value="{$value|ret_template_name}">{$value}</option>
                                        {/if}
                                        {/foreach}
                                    </select>
                                </td>
                                <td>*</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <!--SEO设置-->
                    <div class="layui-tab-item">
                        <table class="layui-table">
                            <colgroup>
                                <col width="10%">
                                <col width="70%">
                                <col>
                            </colgroup>
                            <thead>
                            <tr>
                                <th>名称</th>
                                <th>值</th>
                                <th></th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td>seo标题</td>
                                <td>
                                    <input type="text" name="seo_title" value="{$data.seo_title}" class="layui-input">
                                </td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>seo关键词</td>
                                <td>
                                    <input type="text" name="seo_keywords" value="{$data.seo_keywords}" class="layui-input">
                                </td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>seo描述</td>
                                <td>
                                    <textarea name="seo_description" class="layui-textarea">{$data.seo_description}</textarea>
                                </td>
                                <td></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <!--内容-->
                    <div class="layui-tab-item">
                        <div class="layui-form-item">
                            <!-- 加载编辑器的容器 -->
                            <script id="container" name="content" type="text/plain">{$data.content|raw}</script>
                        </div>
                    </div>
                    <input type="hidden" name="id" value="{$data.id}">
                    <button class="layui-btn layui-btn-sm" lay-submit lay-filter="formDemo">
                        <i class="layui-icon layui-icon-release"></i> 提交
                    </button>
                </div>
            </div>

        </form>
    </div>
    <!--js-->
    {include file="public/source_bottom" /}
    {include file="public/source_bottom_ueditor" /}
    <script>
        let ue = UE.getEditor('container');
        //监听提交
        form.on('submit(formDemo)', function(d){
            $.ajax({
                type: "POST"
                ,data: d.field
                ,success: function(msg){
                    layer.closeAll('loading');
                    if(msg.code == 1){
                        layer.alert(msg.msg, {icon: 1},function(index){
                            layer.close(index);
                            window.location.href = "{:url('columnList')}";
                        });
                    }else{
                        layer.alert(msg.msg, {icon: 2},function(index){
                            layer.close(index);
                        });
                    }
                },error: function(){
                    layer.closeAll('loading');
                    layer.msg('数据提交错误');
                },beforeSend: function(){
                    layer.load();
                }
            });
            return false;
        });

        //图片上传|无缩略图
        upload.render({
            elem: '.upimg'
            ,url:"{:url('Upload/uploadImg')}"
            ,accept:"image"
            ,acceptMime:"image/*"
            ,exts:"{vacms:config name='file_image_ext'/}".replace(/,/g,'|')
            ,size:"{vacms:config name='file_image_size'/}"
            ,done: function(res, index, upload){
                if (res.code == 1){
                    let item = this.item;
                    $(item).siblings('.yulan').removeClass('layui-hide').attr('href',res.msg)
                    $(item).siblings('.v-pic').attr('value',res.msg)
                }else{
                    layer.alert(res.msg)
                }

            }
        })
    </script>
</body>
</html>