<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <title>自定义表单列表</title>
    {include file="public/source_head"}
</head>
<body>
<div class="layui-fluid">

    <blockquote class="layui-elem-quote va-head-positon">
                <span class="layui-breadcrumb">
                    <a><i class="layui-icon layui-icon-home"></i> 当前位置</a>
                    <a><cite>自定义表单</cite></a>
                </span>
        <div class="layui-btn-group">
            <a class="layui-btn layui-btn-xs layui-btn-normal" onclick="i_reload()">
                <i class="layui-icon layui-icon-refresh"></i> 刷新
            </a>
            <a class="layui-btn layui-btn-xs layui-btn-danger" href="{:url('formsAdd')}">
                <i class="layui-icon layui-icon-add-1"></i> 增加自定义表单
            </a>
        </div>
    </blockquote>

    <form class="layui-form">
        <table class="layui-table layui-hide" lay-filter="static">
            <thead>
            <tr>
                <th lay-data="{field:'id', width:60}">ID</th>
                <th lay-data="{field:'name'}">名称</th>
                <th lay-data="{field:'data'}">数据</th>
                <th lay-data="{field:'create_time'}">创建时间</th>
                <th lay-data="{field:'order'}">排序</th>
                <th lay-data="{field:'edit', width:150}"></th>
            </tr>
            </thead>
            <tbody>
            {volist name="data" id="vo"}
            <tr>
                <td>{$vo.id}</td>
                <td>{$vo.name}</td>
                <td>
                    <div class="layui-btn-group">
                        <a class="layui-btn layui-btn-sm layui-btn-primary" href="{:url('formsData',['id'=>$vo.id])}">
                            <i class="layui-icon layui-icon-triangle-r"></i> {$vo.with_data_count}
                        </a>
                    </div>
                </td>
                <td>{$vo.create_time|date='Y-m-d'}</td>
                <td>{$vo.order}</td>
                <td>
                    <div class="layui-btn-group">
                        <a class="layui-btn layui-btn-sm layui-btn-primary" href="{:url('formsEdit',['id'=>$vo.id])}" title="修改">
                            <i class="layui-icon">&#xe642;</i>
                        </a>
                        <a class="layui-btn layui-btn-sm layui-btn-primary" onclick="deleteId('{$vo.id}')" title="删除">
                            <i class="layui-icon">&#xe640;</i>
                        </a>
                    </div>
                </td>
            </tr>
            {/volist}
            </tbody>
        </table>
    </form>
</div>
<!--js-->
{include file="public/source_bottom" /}
<script>
    $(function (){
        //转换静态表格
        table.init('static', {
            limit: 10,
            page:true,
            size:'lg'

        });
    })
    //删除
    function deleteId(id){
        layer.confirm('确认删除?', {icon: 3, title:'提示'}, function(index){
            $.ajax({
                url :"{:url('formsDelete')}",
                type: "POST"
                ,data: {
                    id: id,
                    db: 'adminer'
                }
                ,success: function(msg){
                    layer.closeAll('loading'); //关闭加载层
                    if(msg.code == 1){
                        layer.alert(msg.msg, {icon: 1},function(index){
                            layer.close(index);
                            window.location.reload();
                        });
                    }else{
                        layer.alert(msg.msg, {icon: 2},function(index){
                            layer.close(index);
                        });
                    }
                },error: function(){
                    layer.closeAll('loading');
                    layer.msg('数据提交错误');
                },beforeSend: function(){
                    layer.load();
                }
            });
            layer.close(index);
        });
    }
</script>
</body>
</html>